var liveResultType,liveResult,gameCode=util.$gameCode(),box=$("#dataMain"),listTb=$("#list tbody"),liveResultUrl=util.$apiUrl+"/data/Current/"+gameCode+"/CurIssue.json",firstLoad=!0,liveCtrl={init:function(){this.testData()},getNewByGamecode:function(){reqTimer=setInterval(function(){util.$ajaxGet(liveResultUrl,"",function(e){var t=e;liveResult.preIssue!=t.preIssue&&(setTimeout(liveCtrl.getList,3e3),liveResultType=1,liveResult=t,clearInterval(reqTimer))})},1e3)},writeData:function(e){box.find(".info .preissue").text(e.preIssue),box.find(".info .date").text(util.timeFormat(e.currentOpenDateTime,1));for(var t="",i=0;i<e.openNum.length;i++){t+="<li>"+e.openNum[i]+"</li>"}box.find(".opennum ul").html(t),10==e.preIssue.length&&1104==e.preIssue.substr(e.preIssue.length-4,4)?box.find(".issue span").text("waiting"):box.find(".issue span").text(e.preIssue-0+1)},testData:function(){function e(){s.writeData(liveResult),liveResultType?(t=liveResult,liveResultType=0,l=setInterval(function(){t.openDateTime>serverTime?box.find(".timeleft").text(util.timeFormat(t.openDateTime-serverTime)):(box.find(".timeleft").text("waiting..."),clearInterval(l),e())},1e3)):(box.find(".timeleft").text("waiting..."),s.getNewByGamecode(gameCode),i=setInterval(function(){liveResultType&&(clearInterval(i),e())},500))}var t,i,l,s=this;e()},getList:function(e){e&&listTb.empty();e=e||$("#calendar").val();util.$ajaxGet(util.$apiUrl+"/data/"+gameCode+"/lotteryList/"+e+".json?"+util.randomNum(20),"",function(e){firstLoad&&(firstLoad=0);for(var t="",i="jspk10"==gameCode||"jsft"==gameCode?"bgred":"bggreen",l=0;l<e.length;l++){var s=e[l];t+="<tr><td>"+s.issue+"</td><td>"+s.openDateTime+"</td><td>";for(var a=0;a<s.openNum.length;a++){t+='<span class="'+i+'">'+s.openNum[a]+"</span>"}t+="</td></tr>"}listTb.html(t)})},calendar:function(){laydate({elem:"#calendar",max:laydate.now(),istoday:!1,choose:function(e){liveCtrl.getList(e)}})}};$(function(){liveCtrl.calendar(),util.$ajaxGet(liveResultUrl,"",function(e){liveResult=e,e.issue-e.preIssue!=2&&serverTime<e.openDateTime&&(liveResultType=1);var t=10==liveResult.issue.length||9==liveResult.issue.length&&liveResult.issue.substr(-3)>792?util.getDateStr(serverTime,-1):util.getDateStr(serverTime);$("#calendar").attr("value",t),liveCtrl.getList(),liveCtrl.init()})});